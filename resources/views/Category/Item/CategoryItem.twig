{% extends "PluginCallisto::PageDesign.PageDesign" %}

{% set itemSort             = request.get("itemSorting") | default( config('PluginCallisto.sort.defaultSorting') ) | split('_') %}
{% set orderBy              = itemSort[0] %}
{% set orderByKey           = itemSort[1] | default('ASC') %}
{% set variationShowType    = config("PluginCallisto.global.category.variation_show_type") %}
{% set categoryParams = {
    'variationShowType' : config("PluginCallisto.global.category.variation_show_type"),
    'itemsPerPage'      : request.get("items_per_page") | default( config('PluginCallisto.pagination.defaultItemsPerPage') ),
    'orderBy'           : itemSort[0],
    'orderByKey'        : itemSort[1] | default('ASC')
} %}

{% set page                 = request.get("page") | default(1) %}
{% set paginatedResult      = services.category.getItems(category, categoryParams, page ) %}

{% set itemList             = paginatedResult.getResult() %}
{% set paginationType       = config("PluginCallisto.sort.paginationPosition") %}

{% block PageBody %}

    {{ component( "PluginCallisto::Category.Item.Components.ItemListSort" ) }}
    {{ component( "PluginCallisto::Category.Item.Components.Pagination" ) }}

    <div class="categoriegrid page-content container-max">
        <div class="row m-y-1">
            <div class="col-xs-12">
                <h1>{{ category.details.first.name }}</h1>
                <hr class="hidden-sm-down">
            </div>
        </div>
        <div class="row m-b-3">
            <div class="col-xs-12">
                <div class="list-controls row">
                    <div class="col-xs-12 col-sm-6 m-b-1">

                        {% include "PluginCallisto::Category.Item.Partials.Pagination" with { 'paginatedResult': paginatedResult } %}

                    </div>
                    <div class="col-xs-12 col-sm-3 page-infos m-b-1">
                        <!-- TODO styles for row layout -->
                        <!-- <div class="toggle-list-view pull-xs-left m-r-1">
                            <i class="fa fa-th" aria-hidden="true"></i>
                            <i class="fa fa-th-list" aria-hidden="true"></i>
                        </div> -->
                        <div class="product-count pull-xs-right">
                            <span class="text-muted">{{ trans("PluginCallisto::Callisto.itemCategoryShow") }}:</span> 
                            <span>{{ pageIndicator }}</span> 
                            <span class="text-muted">
                                {{ trans("PluginCallisto::Callisto.itemCategoryShowOf") }} 
                                {{ maxCount }} 
                                {{ trans("PluginCallisto::Callisto.itemItems") }}
                            </span>
                        </div>
                    </div>

                    <div class="col-xs-12 col-sm-3 m-b-1">
                        <item-list-pagination pagination-position="{{ paginationType }}"
                                              position="top" max-count="{{ maxCount }}">
                        </item-list-pagination>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                {% include "PluginCallisto::Category.Item.Partials.CategoryViewFilter" %}
            </div>

            <div class="col-lg-9">

                <ul class="product-list row grid">
                    {% for item in itemList %}
                        <li>
                          {% include "PluginCallisto::Category.Item.Partials.CategoryListItem" with { 'item': item } %}
                        </li>
                    {% endfor %}
                </ul>
                <hr class="m-y-2">

                <div class="list-controls m-b-3 row">
                    <div class="col-xs-12">
                        <item-list-pagination
                                pagination-position="{{ paginationType }}"
                                position="top" max-count="{{ maxCount }}">
                        </item-list-pagination>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
